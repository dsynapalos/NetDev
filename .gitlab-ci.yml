image: ubuntu:18.04
stages:
  - vpn_connect

before_script:
  - apt-get update -y
  - apt-get upgrade -y
  - apt-get install -y python3 python3-pip openconnect iputils-ping procps
  - pip3 install ansible


Connect to Cisco Sandbox:
  stage: vpn_connect
  script:
    - touch $OC_PID
    #- echo $VPN_PASS | openconnect -b -v --pid-file=$OC_PID --user=$VPN_USER --passwd-on-stdin devnetsandbox-us-sjc.cisco.com:$VPN_PORT
    #- ping $CSR1000V_HOST -c 4
    - touch inventory
    - echo "CSR1000V ansible_host=${CSR1000V_HOST}" > inventory
    - cat inventory
    - ansible-playbook test_playbook -i inventory -e "CSR1000V_HOST=${CSR1000V_HOST} CSR1000V_USER=${CSR1000V_USER} CSR1000V_PASS=${CSR1000V_PASS}"
    
  
after_script:
  #- pkill -2 -e -F $OC_PID
